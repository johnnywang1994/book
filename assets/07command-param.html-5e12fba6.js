import{_ as a,r as e,o as l,c as t,d as s,e as i,a as o,f as p}from"./app-6ffe09b2.js";const c={},d=p(`<h1 id="command-line-params-指令列參數處理" tabindex="-1"><a class="header-anchor" href="#command-line-params-指令列參數處理" aria-hidden="true">#</a> Command Line Params 指令列參數處理</h1><h2 id="shift-指令" tabindex="-1"><a class="header-anchor" href="#shift-指令" aria-hidden="true">#</a> shift 指令</h2><p>用於從左邊刪掉 n 個位置的參數，</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">shift</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token comment"># n 預設為 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>範例</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># bash hello.sh 1 2 3</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$*</span> <span class="token comment"># 1 2 3</span>
<span class="token builtin class-name">shift</span> <span class="token number">2</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$*</span> <span class="token comment"># 3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或是製作一個執行子指令的工具入口</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">sub_cmd</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token punctuation">;</span>
<span class="token builtin class-name">shift</span>
/utility_path/bin/<span class="token variable">$sub_cmd</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="選項解析" tabindex="-1"><a class="header-anchor" href="#選項解析" aria-hidden="true">#</a> 選項解析</h2><p>shell 本身不區分參數中的選項、非選項，必須在腳本內去解析，常見三種方式：</p><ul><li>手動解析：簡單腳本狀況下可行，複雜度越高，解析成本會指數上升</li><li>內建指令 <code>getops</code>：推薦，遵守 POSIX 規範，但僅支援短選項</li><li>外部命令 <code>getop</code>：linux 指令，可以解析長選項</li></ul><p>底下為 <code>getops</code> 使用範例</p><h3 id="getops" tabindex="-1"><a class="header-anchor" href="#getops" aria-hidden="true">#</a> getops</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>getops optstring name <span class="token punctuation">[</span>arg <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>optstring: 選項描述，<code>&quot;ab:c&quot;</code> 表示期望 <code>&quot;-a -b bvalue -c&quot;</code>，<code>b</code>後的<code>:</code>表示一個選項值</li></ul><p>在 <code>while</code> 循環中使用，每次解析一個選項</p><ul><li>如果解析到一個選項，該選項會保存在變數 $name 中，退出碼為 0</li><li>解析到不存在的選項，$name 返回 <code>?</code>，退出碼仍然為 0</li><li>解析到第一個非選項時，退出碼為 1，退出循環</li></ul><blockquote><p>命令使用了兩個隱式變量<code>$OPTIND</code> (OPTion INDex) 和 <code>$OPTARG</code> (OPTion ARGument)。</p></blockquote><ul><li><code>$OPTIND</code> 記錄了下次解析的位置（從 1 開始），在每次執行腳本時被設置為 1，並在解析後累加。</li><li><code>$OPTARG</code> 記錄了當前選項對應的值（如果存在）</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># -c confirm 二次確認</span>
<span class="token comment"># -m message 必須，刪除備註，儲存在 log 中</span>
<span class="token assign-left variable">confirm</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">&quot;cm:&quot;</span> option<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">case</span> <span class="token variable">$option</span> <span class="token keyword">in</span>
    c<span class="token punctuation">)</span> <span class="token assign-left variable">confirm</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    m<span class="token punctuation">)</span> <span class="token assign-left variable">message</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$OPTARG</span>&quot;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    ?<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;參數錯誤&quot;</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">shift</span> <span class="token variable"><span class="token variable">$((</span>$OPTIND<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> <span class="token comment"># 去除參數中已解析的部分</span>

<span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token variable">$@</span>
<span class="token assign-left variable">default_message</span><span class="token operator">=</span><span class="token string">&quot;刪除檔案 <span class="token variable">$files</span>&quot;</span>

<span class="token keyword">if</span> <span class="token variable"><span class="token punctuation">((</span> $confirm <span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;是否確認刪除文件 <span class="token variable">$files</span> (Y/N):&quot;</span> confirmed
  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$confirmed</span> <span class="token operator">==</span> <span class="token punctuation">[</span>^yY<span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token comment"># 如果不是 y、Y 則退出</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token function">rm</span> <span class="token variable">$files</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;log: <span class="token variable">\${message<span class="token operator">:-</span>$default_message}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> log.txt
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> Reference</h2>`,21),r={href:"https://juejin.cn/post/7130983293347954718",target:"_blank",rel:"noopener noreferrer"};function u(k,m){const n=e("ExternalLinkIcon");return l(),t("div",null,[d,s("ul",null,[s("li",null,[s("a",r,[i("Shell 腳本編程"),o(n)])])])])}const b=a(c,[["render",u],["__file","07command-param.html.vue"]]);export{b as default};
