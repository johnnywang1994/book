import{_ as k,r,o as v,c as m,a as o,d as n,e as p,f as b}from"./app-4f8ac264.js";const h={methods:{playVideo(){this.$refs.bgVideoRef.play()},pauseVideo(){this.$refs.bgVideoRef.pause()},initCanvas(){var s=this._canvas=this.$refs.videoBg;this._ctx=s.getContext("2d")},initVideo(){const s=this._canvas,e=this._ctx,a=this.$refs.bgVideoRef,l=a.style.display;let c=1;a.style.display="block",a.addEventListener("loadeddata",()=>{s.width=a.videoWidth,s.height=a.videoHeight,c=a.videoHeight/a.videoWidth,a.style.display=l,t()});function t(){e.drawImage(a,0,0,s.width,s.width*c),requestAnimationFrame(t)}}},mounted(){const s=this;s.initCanvas(),s.initVideo()}},g=n("h1",{id:"如何把-video-畫在-canvas-上",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#如何把-video-畫在-canvas-上","aria-hidden":"true"},"#"),p(" 如何把 Video 畫在 Canvas 上")],-1),_=n("p",null,"Hi 大家好，我是 Johnny，今天這篇來介紹個小玩意，如標題，該怎麼把 Video 畫在 Canvas 上呢？",-1),y=n("h2",{id:"背景",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#背景","aria-hidden":"true"},"#"),p(" 背景")],-1),f=n("p",null,"把 Video 畫在 Canvas 上可以有很多用處，比如我們可以對影像背景進行即時改變，或是給予其他更大的創意操作彈性，但...創意部份就留給大家發想了，本篇會專注在如何轉換的過程上摟~",-1),w=n("h2",{id:"實際效果",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#實際效果","aria-hidden":"true"},"#"),p(" 實際效果")],-1),x=n("p",null,"本篇會以 Vue 來實作，不過不會涉及太複雜的使用，只需要大概懂基礎就好",-1),V=n("p",null,"實作前，先實際展示 Canvas 影片效果給大家看~",-1),q=n("p",null,"試著把手機打橫、放直看看效果吧!",-1),C={id:"canvas-draw-video--wrapper"},B={ref:"bgVideoRef",crossorigin:"anonymous",playsinline:"",loop:""},E=n("source",{src:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"},null,-1),j=[E],I={class:"canvas-container"},A={ref:"videoBg"},D=b(`<h2 id="實作" tabindex="-1"><a class="header-anchor" href="#實作" aria-hidden="true">#</a> 實作</h2><p>首先我們把 video 先正確顯示在網頁上面，如下範例:</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">playsinline</span> <span class="token attr-name">loop</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>video/mp4<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>應該就能看到我們帥氣的影片出現拉~</p><p>接著我們將影片隱藏起來，並添加我們的目標 Canvas，預留兩個 ref 待後續使用</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">#app</span> <span class="token punctuation">{</span>
  <span class="token selector">video</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">canvas</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bgVideoRef<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span> <span class="token attr-name">playsinline</span> <span class="token attr-name">loop</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>video/mp4<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>videoBg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接著處理我們的主要邏輯，透過監聽影片 <code>loadeddata</code> 事件，取得影片的實際寬高比例，並將 canvas 的 pixel resolution 設為影片寬高，透過這個方式才能維持原影片的畫質正確，否則預設 canvas 的 pixel 比例會是 300x150</p><blockquote><p>canvas 元素上的 width, height 並不單單只影響 DOM 寬高，而是真正影響畫布的 pixel resolution，用 css style 影響的才是顯示的寬高，所以即使你用 css 去設定 canvas，如果沒有明確去定義 width, height 屬性，那麼內容的 pixel resolution 就仍然是預設的配置</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 為求方便直接用 option API 撰寫瞜~</span>
Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
    vm<span class="token punctuation">.</span><span class="token function">initCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    vm<span class="token punctuation">.</span><span class="token function">initVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">initCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>videoBg<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">initVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_canvas<span class="token punctuation">;</span>
      <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_ctx<span class="token punctuation">;</span>
      <span class="token keyword">const</span> videoEl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>bgVideoRef<span class="token punctuation">;</span>
      <span class="token keyword">const</span> _display <span class="token operator">=</span> videoEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token punctuation">;</span>
      <span class="token keyword">let</span> ratio <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

      videoEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span>
      videoEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;loadeddata&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// set canvas pixel resolution</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> videoEl<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> videoEl<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
        <span class="token comment">// get video ratio</span>
        ratio <span class="token operator">=</span> videoEl<span class="token punctuation">.</span>videoHeight <span class="token operator">/</span> videoEl<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
        <span class="token comment">// recover videoEl display</span>
        videoEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> _display<span class="token punctuation">;</span>
        <span class="token comment">// create fabric image</span>
        <span class="token function">drawVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// start</span>
        videoEl<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">function</span> <span class="token function">drawVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
          videoEl<span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
          canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> ratio
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawVideo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果這時我們希望讓影片能夠自適應，並且始終填滿畫面，而將 CSS 改為如下</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">#app</span> <span class="token punctuation">{</span>
  <span class="token selector">video</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">canvas</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>這樣寫你會發現，我們的 Canvas 就被拉伸了~NO~~!! 影片內容是有填滿畫面沒錯，但是比例整個跑掉啦~</p><p>大家猜猜能怎麼解，5,4,3,2,1...</p><p>沒錯，直接在 Canvas 外面再包一層 <code>.canvas-container</code> 並且將內部的 Canvas 設為 <code>object-fit</code> ，搞定!!</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">#app</span> <span class="token punctuation">{</span>
  <span class="token selector">video</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.canvas-container</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
    <span class="token selector">canvas</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">object-fit</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那今天的分享就到這邊摟，希望大家會喜歡，也歡迎大家分享給更多人看看玩玩瞜，謝謝大家 =V=~</p>`,17),N=n("h2",{id:"參考",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#參考","aria-hidden":"true"},"#"),p(" 參考")],-1),R={href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas",target:"_blank",rel:"noopener noreferrer"},S={href:"http://fabricjs.com/video-element",target:"_blank",rel:"noopener noreferrer"};function W(s,e,a,l,c,t){const u=r("SocialBlock"),d=r("ExternalLinkIcon");return v(),m("div",null,[g,o(u,{hashtags:"javascript,canvas,video,fullpage"}),_,y,f,w,x,V,q,n("div",C,[n("button",{style:{"margin-right":"12px"},onClick:e[0]||(e[0]=(...i)=>t.playVideo&&t.playVideo(...i))},"Play"),n("button",{onClick:e[1]||(e[1]=(...i)=>t.pauseVideo&&t.pauseVideo(...i))},"Pause"),n("video",B,j,512),n("div",I,[n("canvas",A,null,512)])]),D,o(u,{hashtags:"javascript,canvas,video,fullpage"}),N,n("ul",null,[n("li",null,[n("a",R,[p("MDN Web Doc"),o(d)])]),n("li",null,[n("a",S,[p("Fabricjs Demo"),o(d)])])])])}const H=k(h,[["render",W],["__file","canvas-draw-video.html.vue"]]);export{H as default};
