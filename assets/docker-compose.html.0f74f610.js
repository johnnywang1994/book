import{_ as t,r as i,o as p,c as o,d as n,e as s,a as e,f as l}from"./app.b02cd678.js";const c={},u=l(`<h1 id="docker-compose-\u6280\u8853\u7BC7-3-7" tabindex="-1"><a class="header-anchor" href="#docker-compose-\u6280\u8853\u7BC7-3-7" aria-hidden="true">#</a> Docker-compose \u6280\u8853\u7BC7 - 3.7</h1><p>\u672C\u7BC7\u4E3B\u8981\u7D00\u9304docker-compose\u7684\u4F7F\u7528\u65B9\u6CD5\u8207\u7B46\u8A18</p><h2 id="basic-\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#basic-\u6982\u5FF5" aria-hidden="true">#</a> Basic \u6982\u5FF5</h2><p>\u4E3B\u8981\u7528\u4EE5\u65B9\u4FBF\u5275\u5EFA\u4E26\u7BA1\u7406\u591A\u500B\u76F8\u95DC\u806F\u7684\u670D\u52D9container\uFF0C\u4E26\u8A2D\u5B9A\u76F8\u95DC\u529F\u80FD\u7B49\u3002</p><p>Compose \u6A94\u6848\u70BA YAML \u6A94\u6848\uFF0C\u7528\u4EE5\u5B9A\u7FA9 <code>services</code>, <code>networks</code>, <code>volumes</code>, <code>ports</code> \u7B49\u7B49</p><p>\u9810\u8A2D\u7684\u6A94\u6848\u540D\u70BA <code>./docker-compose.yml</code> or <code>./docker-compose.yaml</code></p><p>\u4E00\u500Bservice\u7684\u5B9A\u7FA9\u4E2D\uFF0C\u5305\u542B\u8981\u61C9\u7528\u65BC\u8A72container\u7684\u4E00\u4E9B\u7D44\u614B(config)\uFF0C\u5C31\u50CF\u4F7F\u7528<code>docker container create</code></p><p>\u53CA <code>docker network create</code>, <code>docker volume create</code>\u7B49</p><h2 id="\u4E3B\u8981\u8A2D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u8981\u8A2D\u7F6E" aria-hidden="true">#</a> \u4E3B\u8981\u8A2D\u7F6E</h2><p><em><strong>build</strong></em></p><p>\u61C9\u7528\u65BCbuild\u968E\u6BB5\u7684\u8A2D\u5B9A</p><p><code>build</code> \u53EF\u4F7F\u7528\u5B57\u4E32\u6307\u5B9Acontext\u4F4D\u7F6E\uFF0C</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./dir
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6216\u50B3\u5165\u7269\u4EF6\u4E26\u6307\u5B9Acontext\u4F4D\u7F6E</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">webapp</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span>
      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile<span class="token punctuation">-</span>alternate
      <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token key atrule">buildno</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>context</code> \u53EF\u6307\u5B9A\u8DEF\u5F91\u6216\u662F\u4E00\u500Bgit \u5C08\u6848\u4F4D\u7F6EURL\uFF0C\u82E5\u6307\u5B9A\u76F8\u5C0D\u4F4D\u7F6E\u6642\uFF0C\u5247\u76F8\u5C0D\u65BC\u6B64compose\u6A94</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> ./dir
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p><code>dockerfile</code> \u6307\u5B9A\u69CB\u5EFA\u7528\u7684dockerfile\uFF0C\u5FC5\u9808\u540C\u6642\u7D66\u69CB\u5EFA\u4F4D\u7F6Econtext</p></li><li><p><code>args</code> \u53EF\u6307\u5B9A\u5728Dockerfile\u5167\u5B9A\u7FA9\u7684\u53C3\u6578\u503C</p></li></ol><p>\u9996\u5148\u5728dockerfile\u4E2D\u5B9A\u7FA9arguments</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ARG name
ARG age

RUN <span class="token builtin class-name">echo</span> <span class="token string">&quot;username: <span class="token variable">$name</span>&quot;</span>
RUN <span class="token builtin class-name">echo</span> <span class="token string">&quot;userage: <span class="token variable">$age</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A5\u8457\u5728<code>build</code>\u4E0B\u5B9A\u7FA9<code>args</code>\uFF0C\u4E26\u8A2D\u5B9A\u503C\u4F7F\u7528</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Johnny
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">24</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF0C\u7576<code>ARG</code> \u4F7F\u7528\u65BC<code>FROM</code>\u4E0A\u9762\uFF0C\u5247<code>ARG</code>\u7684\u53C3\u6578\u5C07\u7121\u6CD5\u7528\u65BC<code>FROM</code>\u4E0B\u65B9\uFF0C\u82E5\u9700\u8981\u4F7F\u7528</p><p>\u5247\u5FC5\u9808\u5B9A\u7FA9\u65BC\u5169\u5074: \u53EF\u898B <code>Dockerfile \u6280\u8853\u7BC7</code> \u4E4B\u8AAA\u660E\u3002</p><p>\u53E6\u5916 Boolean \u7B49\u503C\u5728 YAML \u6A94\u4E2D\u8ACB\u7528quotes\u95DC\u9589</p><ol start="4"><li><code>cache_from</code> v3.2\u65B0\u589E\uFF0C\u5217\u51FA\u4F7F\u7528cache\u7684images\u6E05\u55AE</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">cache_from</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> alpine<span class="token punctuation">:</span>latest
    <span class="token punctuation">-</span> corp/web_app<span class="token punctuation">:</span><span class="token number">3.14</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li><code>labels</code> v3.3\u65B0\u589E\uFF0C\u65B0\u589Emetadata\u65BC\u6307\u5B9Aimage</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">maintainer</span><span class="token punctuation">:</span> <span class="token string">&quot;Johnny Wang&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li><code>shm_size</code> v3.5\u65B0\u589E\uFF0C\u8A2D\u7F6Esize of <code>/dev/shm</code> for this build&#39;s container\u3002</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">shm_size</span><span class="token punctuation">:</span> <span class="token string">&#39;2gb&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OR</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">context</span><span class="token punctuation">:</span> .
  <span class="token key atrule">shm_size</span><span class="token punctuation">:</span> <span class="token number">10000000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>image</strong></em></p><p>\u6307\u5B9A\u5EFA\u69CB\u670D\u52D9\u7528\u7684image\uFF0C\u53EF\u4EE5\u662F\u5C08\u6848/tag\u6216\u662F\u6307\u5B9Aimage_id</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> redis
<span class="token key atrule">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span><span class="token number">14.04</span>
<span class="token key atrule">image</span><span class="token punctuation">:</span> tutum/influxdb
<span class="token key atrule">image</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>registry.com<span class="token punctuation">:</span>4000/postgresql
<span class="token key atrule">image</span><span class="token punctuation">:</span> a4bc65fd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7576\u672C\u5730\u4E0D\u5B58\u5728\u8A72image\u6642\uFF0C\u6703\u81EA\u52D5pull\u4E0B\u4F86\u4F7F\u7528</p><p><em><strong>command</strong></em></p><p>\u8986\u84CBdefault command</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> bundle exec thin <span class="token punctuation">-</span>p 3000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>OR</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bundle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exec&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;thin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-p&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><em><strong>container_name</strong></em></p><p>\u6307\u5B9A\u76EE\u6A19container name\uFF0C\u800C\u975E\u4F7F\u7528\u9810\u8A2Dname</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">container_name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>web
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><em><strong>depends_on</strong></em></p><p>\u5B9A\u7FA9\u5404\u670D\u52D9\u4E4B\u9593\u7684\u4F9D\u8CF4\u95DC\u4FC2\uFF0C\u9020\u6210\u4E0B\u65B9\u884C\u70BA\uFF1A</p><ol><li><p><code>docker-compose up</code> \u555F\u52D5\u9806\u5E8F\uFF0C\u4E0B\u65B9\u7BC4\u4F8B<code>db</code>, <code>redis</code>\u6703\u5728<code>web</code>\u4E4B\u524D\u555F\u52D5</p></li><li><p><code>docker-compose up SERVICE</code> \u55AE\u7368\u555F\u52D5\u67D0\u500Bservice\u6642\uFF0C\u6703\u81EA\u52D5\u52A0\u5165\u4F9D\u8CF4\u7684\u670D\u52D9\uFF0C</p></li></ol><pre><code>\u4E0B\u65B9\u555F\u52D5\`web\`\u6642\uFF0C\u540C\u6642\u81EA\u52D5\u555F\u52D5\`db\`, \`redis\`
</code></pre><ol start="3"><li><code>docker-compose stop</code> \u95DC\u9589\u9806\u5E8F\uFF0C\u4E0B\u65B9\u7BC4\u4F8B<code>web</code>\u6703\u5728<code>db</code>, <code>redis</code>\u95DC\u9589\u524D\u5148\u95DC\u9589</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
      <span class="token punctuation">-</span> redis
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528<code>depends_on</code>\u6CE8\u610F\u4E8B\u9805\uFF1A</p>`,52),d=n("p",null,[n("code",null,"depends_on"),s(" \u4E26\u975E\u7B49\u5F85"),n("code",null,"db"),s(", "),n("code",null,"redis"),s("\u555F\u52D5 ready \u624D\u555F\u52D5"),n("code",null,"web"),s("\uFF0C\u53EA\u662F\u7B49\u5230\u5B83\u5011\u5DF2\u7D93"),n("code",null,"\u555F\u52D5"),s("\uFF0C")],-1),r={href:"https://docs.docker.com/compose/startup-order/",target:"_blank",rel:"noopener noreferrer"},k=n("li",null,[n("p",null,[s("v3.0\u4E0D\u518D\u652F\u63F4\u4F7F\u7528"),n("code",null,"condition"),s("\u683C\u5F0F\u65BC"),n("code",null,"depends_on")])],-1),m=n("code",null,"depends_on",-1),v={href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,[n("em",null,[n("strong",null,"deploy")]),s(" v3.0 only")],-1),g={href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"},y=l(`<p>\u5C6Cswarm\u6642\uFF0C\u5728<code>docker-compose up</code>\u53CA<code>docker-compose run</code>\u4E2D\u6703\u88AB\u5FFD\u7565</p><p>(\u5F85\u88DC)</p><p><em><strong>devices</strong></em></p><p>\u5217\u51FA\u88DD\u7F6E\u7684mapping\uFF0C\u5728deploy a stack in swarm mode\u4F7F\u7528 v3.0 compose file\u6703\u88AB\u7701\u7565</p><p><em><strong>dns</strong></em></p><p>\u5BA2\u88FD DNS server\uFF0C\u53EF\u4EE5\u662F\u4E00\u500B\u503C\u6216\u662F\u9663\u5217</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dns</span><span class="token punctuation">:</span> 8.8.8.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dns</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 8.8.8.8
  <span class="token punctuation">-</span> 9.9.9.9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>dns_search</strong></em></p><p>\u5BA2\u88FD DNS search domain\uFF0C\u53EF\u4EE5\u662F\u4E00\u500B\u503C\u6216\u662F\u9663\u5217</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dns_search</span><span class="token punctuation">:</span> example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dns_search</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> dc1.example.com
  <span class="token punctuation">-</span> dc2.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>entrypoint</strong></em></p><p>\u8986\u84CB\u9810\u8A2Dentrypoint</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> /code/entrypoint.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">entrypoint</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> php
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>d
    <span class="token punctuation">-</span> zend_extension=/usr/local/lib/php/extensions/no<span class="token punctuation">-</span>debug<span class="token punctuation">-</span>non<span class="token punctuation">-</span>zts<span class="token punctuation">-</span>20100525/xdebug.so
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>d
    <span class="token punctuation">-</span> memory_limit=<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token punctuation">-</span> vendor/bin/phpunit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>env_file</strong></em></p><p>\u5F9E\u6A94\u6848\u65B0\u589E\u74B0\u5883\u8B8A\u6578\uFF0C\u53EF\u4EE5\u662F\u4E00\u500B\u503C\u6216\u9663\u5217\uFF0C\u6CE8\u610F\u5F15\u5165\u9806\u5E8F\uFF0C\u53EF\u80FD\u8907\u5BEB\u8ABF\u76F8\u540Ckey\u540D\u7684\u503C</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">env_file</span><span class="token punctuation">:</span> .env
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><em><strong>environment</strong></em></p><p>\u8A2D\u5B9A\u74B0\u5883\u8B8A\u6578\uFF0C\u53EF\u4EE5\u662F\u4E00\u500B\u9663\u5217\u6216\u662F\u7269\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SHOW</span><span class="token punctuation">:</span> <span class="token string">&#39;true&#39;</span>
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SHOW=true
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>expose</strong></em></p><p>Expose ports without publishing them to host machine, only be accesible to linked services</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">expose</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;3000&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;8000&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>external_links</strong></em></p><p>\u9023\u7D50\u5230\u5916\u90E8\u7684container(\u555F\u52D5\u65BC\u6B64docker-compose.yml\u4EE5\u5916)</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">external_links</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> redis_1
 <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>mysql
 <span class="token punctuation">-</span> project_db_1<span class="token punctuation">:</span>postgresql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>extra_hosts</strong></em></p><p>Add hostname mappings, is created in <code>/etc/hosts</code>.</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;somehost:162.242.195.82&quot;</span>
 <span class="token punctuation">-</span> <span class="token string">&quot;otherhost:50.31.209.229&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>Logging</strong></em></p><p>Logging \u670D\u52D9\u7D44\u614B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;json-file&quot;</span>
  <span class="token key atrule">options</span><span class="token punctuation">:</span>
    <span class="token key atrule">syslog-address</span><span class="token punctuation">:</span> <span class="token string">&quot;tcp://192.168.0.42:123&quot;</span>
    <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">&quot;200k&quot;</span>
    <span class="token key atrule">max-file</span><span class="token punctuation">:</span> <span class="token string">&quot;10&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>dirver</code> \u540D\u7A31\u8207<code>docker run --log-driver</code> \u6307\u5B9A\u70BA\u76F8\u540C\u529F\u80FD</p><p>\u9810\u8A2D\u503C\u70BAjson-file</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;json-file&quot;</span>
<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;syslog&quot;</span>
<span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>network_mode</strong></em></p><p>network \u6A21\u5F0F\uFF0C\u8207<code>docker run --network</code>\u4F7F\u7528\u76F8\u540C\u529F\u80FD(\u6B64\u529F\u80FD\u5728<code>deploying a stack</code>\u4F7F\u7528v3.0 compose file\u6642\u6703\u88AB\u5FFD\u7565)</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;bridge&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;none&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;service:[service name]&quot;</span>
<span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">&quot;container:[container name/id]&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>networks</strong></em></p><p>\u8A2D\u7F6E\u8A72\u670D\u52D9\u52A0\u5165\u7684network\uFF0C\u6703\u53C3\u7167compose\u6A94\u5167key\u70BAnetworks \u7684\u8A2D\u5B9A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> some<span class="token punctuation">-</span>network
     <span class="token punctuation">-</span> other<span class="token punctuation">-</span>network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>aliases</code> \u5225\u540D\uFF0Cis network-scoped\uFF0C\u76F8\u540C\u670D\u52D9\u5728\u4E0D\u540Cnetwork\u4E2D\u53EF\u4EE5\u6709\u4E0D\u540C\u7684\u5225\u540D</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">some-service</span><span class="token punctuation">:</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">some-network</span><span class="token punctuation">:</span>
        <span class="token key atrule">aliases</span><span class="token punctuation">:</span>
         <span class="token punctuation">-</span> alias1
         <span class="token punctuation">-</span> alias3
      <span class="token key atrule">other-network</span><span class="token punctuation">:</span>
        <span class="token key atrule">aliases</span><span class="token punctuation">:</span>
         <span class="token punctuation">-</span> alias2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0B\u65B9\u7BC4\u4F8B\u4E2D\uFF0C\u5728network <code>new</code> \u53CA <code>legacy</code>\u4E2D\uFF0C<code>new</code>\u7DB2\u8DEF\u4E2D\u53EF\u4EE5\u7D93\u7531<code>db</code>\u6216<code>database</code>\u53D6\u5F97\u8A72\u670D\u52D9</p><p>\u800C<code>legacy</code>\u7DB2\u8DEF\u4E2D\u53EF\u4EE5\u7D93\u7531<code>db</code>\u53CA<code>mysql</code>\u53D6\u7684\u76F8\u540C\u670D\u52D9</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx:alpine&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> new

  <span class="token key atrule">worker</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;my-worker-image:latest&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> legacy

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">new</span><span class="token punctuation">:</span>
        <span class="token key atrule">aliases</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> database
      <span class="token key atrule">legacy</span><span class="token punctuation">:</span>
        <span class="token key atrule">aliases</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> mysql

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">new</span><span class="token punctuation">:</span>
  <span class="token key atrule">legacy</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p><code>ipv4_address</code> and <code>ipv6_address</code> \u6307\u5B9A\u975C\u614Bip\u4F4D\u7F6E\u7D66container\u4E2D\u7684service</p><p>\u4F7F\u7528\u6642\uFF0C\u5728\u6700\u4E0A\u5C64\u7684networks\u4E2D\u5FC5\u9808\u5B9A\u7FA9<code>ipam</code>\u53CA\u76F8\u5C0D\u7684<code>subnet</code>\u8A2D\u5B9A</p></li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>alpine
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">app_net</span><span class="token punctuation">:</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.16.238.10
        <span class="token key atrule">ipv6_address</span><span class="token punctuation">:</span> 2001<span class="token punctuation">:</span>3984<span class="token punctuation">:</span>3989<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">10</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">app_net</span><span class="token punctuation">:</span>
    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> default
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> <span class="token string">&quot;172.16.238.0/24&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> <span class="token string">&quot;2001:3984:3989::/64&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>ports</strong></em></p><p>expose ports\uFF0C\u6B64\u8A2D\u5B9A\u8207<code>network_mode: host</code>\u4E0D\u76F8\u5BB9</p><p><em><strong>restart</strong></em></p><p>(\u5F85\u88DC)</p><p><em><strong>secrets</strong></em></p><p>(\u5F85\u88DC)</p><p><em><strong>volumes</strong></em></p><p>(\u5F85\u88DC)</p><p><em><strong>Error: exited with code 0</strong></em></p><p>Docker-compose \u751F\u6210\u5BB9\u5668\u5F8C\u7ACB\u523B\u9000\u51FA\uFF0C\u662F\u56E0\u70BA\u5728<code>docker run</code> \u4E2D\uFF0C\u6211\u5011\u6703\u52A0\u5165 <code>-it</code></p><p>\u70BA\u5BB9\u5668\u6DFB\u52A0\u4E00\u500B\u507D\u7D42\u7AEF\uFF0C\u6B64\u6642bash\u5C31\u4E0D\u6703\u81EA\u52D5\u9000\u51FA\u3002 \u4F46\u5728<code>docker-compose</code>\u4E2D\uFF0C\u5FC5\u9808\u5728yml\u6A94</p><p>\u4E2D\u6DFB\u52A0\u4E0B\u65B9\u547D\u4EE4</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u7B2C\u4E00\u884C\u7B49\u65BC docker run \u7684 -i</span>
<span class="token comment"># \u7B2C\u4E8C\u884C\u7B49\u65BC docker run \u7684 -t</span>
<span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,64);function h(_,q){const a=i("ExternalLinkIcon");return p(),o("div",null,[u,n("ol",null,[n("li",null,[d,n("p",null,[s("\u82E5\u9700\u8981\u7B49\u5F85\u670D\u52D9\u555F\u52D5\u4E26 ready\uFF0C\u8ACB\u53C3\u95B1"),n("a",r,[s("Controlling startup order"),e(a)])])]),k,n("li",null,[n("p",null,[m,s(" \u63A7\u5236\u9805\u5728swarn \u7684v3.0\u7684compose file\u6703\u81EA\u52D5\u88AB\u5FFD\u7565\uFF0C"),n("a",v,[s("deploying a stack in swarm mode"),e(a)])])])]),b,n("p",null,[s("\u6B64\u63A7\u5236\u9805\u53EA\u555F\u52D5\u65BC\u7528"),n("a",g,[s("docker stack deploy"),e(a)]),s("\u90E8")]),y])}const w=t(c,[["render",h],["__file","docker-compose.html.vue"]]);export{w as default};
