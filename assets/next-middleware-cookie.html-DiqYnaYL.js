import{_ as s,c as a,d as e,o as t}from"./app-aytLpXyP.js";const p={};function o(c,n){return t(),a("div",null,n[0]||(n[0]=[e(`<h1 id="如何在-nextjs-中使用-middleware-set-cookie" tabindex="-1"><a class="header-anchor" href="#如何在-nextjs-中使用-middleware-set-cookie"><span>如何在 Nextjs 中使用 middleware set cookie</span></a></h1><p>在 SSR 情況下，我們時常需要跨 server, client 端傳遞資料，其中 cookie 是必不可少！！</p><p>底下是一個官網的範例，如何在 Next middleware 中處理 cookies</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse<span class="token punctuation">,</span> NextRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/server&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> cookieOpts <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  httpOnly<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  signed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// This function can be marked \`async\` if using \`await\` inside</span></span>
<span class="line"><span class="token comment">// eslint-disable-next-line import/prefer-default-export</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 對 response 設定 cookies</span></span>
<span class="line">  <span class="token keyword">const</span> res <span class="token operator">=</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  res<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;gtmId&#39;</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GTM_ID</span><span class="token punctuation">,</span> cookieOpts<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 從 request 提取 cookies</span></span>
<span class="line">  <span class="token keyword">const</span> cookie <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;vercel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;fast&#39;</span></span>
<span class="line">  <span class="token keyword">const</span> allCookies <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allCookies<span class="token punctuation">)</span> <span class="token comment">// =&gt; [{ key: &#39;vercel&#39;, value: &#39;fast&#39; }]</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> options <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">getWithOptions</span><span class="token punctuation">(</span><span class="token string">&#39;vercel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// =&gt; &#39;fast&#39;</span></span>
<span class="line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// =&gt; { Path: &#39;/test&#39; }</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 刪除 cookies</span></span>
<span class="line">  response<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;vercel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  response<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> res<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很簡單吧～</p>`,5)]))}const i=s(p,[["render",o]]),u=JSON.parse('{"path":"/articles/memo/react/next-middleware-cookie.html","title":"如何在 Nextjs 中使用 middleware set cookie","lang":"zh-TW","frontmatter":{},"git":{"updatedTime":1748788505000,"contributors":[{"name":"JohnnyWang","username":"JohnnyWang","email":"johnnywang@test.com","commits":1,"url":"https://github.com/JohnnyWang"},{"name":"Lindy Liao","username":"","email":"meiliao1207@gmail.com","commits":1}],"changelog":[{"hash":"f01bfa128b4d33fbeddb8abb1697b5391b273d28","time":1748788505000,"email":"meiliao1207@gmail.com","author":"Lindy Liao","message":"UPD"},{"hash":"e01037380d964139f2e657116528def9f43e1b83","time":1662431468000,"email":"johnnywang@test.com","author":"JohnnyWang","message":"UPD: add next-middleware-cookie"}]},"filePathRelative":"articles/memo/react/next-middleware-cookie.md"}');export{i as comp,u as data};
