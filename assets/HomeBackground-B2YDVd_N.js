import{i as g,j as G,k as V,l as J,c as K,o as Q,b as Z}from"./app-C1rAeSlj.js";const A={class:"home-background"},x=30,I=10,N=.1,ee={__name:"HomeBackground",setup(D){var C,k;const S=(e,o=!1)=>new Promise(n=>{const s=document.createElement("img");s.src=e,s.crossOrigin=o?"anonymous":!1,s.onload=()=>n(s)}),B=(e,o,n,s)=>{const t=e-n,a=o-s,r=Math.sqrt(t**2+a**2);return{x:t,y:a,distance:r}},$=(e,o,n,s,t=4)=>{const a=n+t,r=s+t,c=t*t;let l=0,v=0,d=0,m=0;for(let X=n;X<a;X++)for(let Y=s;Y<r;Y++){const M=(X*o+Y)*4;l+=e[M],v+=e[M+1],d+=e[M+2],m+=e[M+3]}const E=l/c,P=v/c,H=d/c,W=m/c;return{x:s+t/2,y:n+t/2,originX:s+t/2,originY:n+t/2,color:`rgba(${E}, ${P}, ${H}, ${W/255})`}},i=g(null),_=g(null),p=g([]),F=g({x:1/0,y:1/0}),R=g(1),f=g();let w,u=(C=i.value)==null?void 0:C.width,y=(k=i.value)==null?void 0:k.height;const j=e=>{const o=Math.round(y/x),n=Math.round(u/x),s=[];for(let t=0;t<o;t++)for(let a=0;a<n;a++){const r=t*x,c=a*x,l=$(e,u,r,c,x);s.push(l)}return s},z=()=>{const e=_.value;e.clearRect(0,0,u,y),p.value.forEach(o=>{e.beginPath(),e.arc(o.x,o.y,x/2,0,Math.PI*2),e.fillStyle=o.color,e.fill()})},U=()=>{const e=p.value,o=F.value,{x:n,y:s}=o;e.forEach(t=>{const{x:a,y:r,distance:c}=B(n,s,t.x,t.y);if(c<w){const l=(w-c)/w,v=Math.atan2(r,a),d=Math.cos(v)*l*I,m=Math.sin(v)*l*I;t.x-=d,t.y-=m}else if(t.x!==t.originX||t.y!==t.originY){const{x:l,y:v,distance:d}=B(t.originX,t.originY,t.x,t.y),m=Math.atan2(v,l),E=Math.cos(m)*d*N,P=Math.sin(m)*d*N;t.x+=E,t.y+=P}})},O=()=>{U(),z(),requestAnimationFrame(O)},q=async e=>{const o=await S(e,!0),{width:n,height:s}=o,t=i.value;f.value=t.getBoundingClientRect(),R.value=n/f.value.width,u=t.width=n,y=t.height=s;const a=_.value;a.drawImage(o,0,0,u,y);const r=a.getImageData(0,0,u,y),c=j(r.data);p.value=c,O()},h=e=>{var a;const o=R.value,n=(a=e==null?void 0:e.touches)==null?void 0:a[0],s=f.value.top,t=f.value.left;F.value={x:((n==null?void 0:n.pageX)-t||e.offsetX)*o,y:((n==null?void 0:n.pageY)-s||e.offsetY)*o}},L=()=>{F.value={x:1/0,y:1/0}},b=()=>{const e=i.value;f.value=e.getBoundingClientRect(),R.value=u/f.value.width};return G(i,()=>{const e=i.value;e&&(e.addEventListener("mousemove",h,{passive:!0}),e.addEventListener("mouseleave",L),e.addEventListener("touchstart",h,{passive:!0}),e.addEventListener("touchmove",h,{passive:!0}),e.addEventListener("touchend",L,{passive:!0}),window.addEventListener("resize",b,{passive:!0}))}),V(()=>{const e=i.value;e&&(e.removeEventListener("mousemove",h),e.removeEventListener("mouseleave",L),e.removeEventListener("touchstart",h),e.removeEventListener("touchmove",h),e.removeEventListener("touchend",L),window.removeEventListener("resize",b))}),J(()=>{w=window.innerWidth<576?300:200;const e=i.value;e&&(_.value=e.getContext("2d"),q("https://raw.githubusercontent.com/jwlearn1994/image-uploader/main/others/myblog/me2.jpeg"))}),(e,o)=>(Q(),K("div",A,[Z("canvas",{ref_key:"canvasRef",ref:i,style:{width:"100%"}},null,512)]))}};export{ee as default};
