import{i as g,j as H,k as W,l as G,c as V,o as J,b as K}from"./app-aytLpXyP.js";const Q={class:"home-background"},x=30,C=10,k=.1,D={__name:"HomeBackground",setup(Z){const I=(e,n=!1)=>new Promise(s=>{const o=document.createElement("img");o.src=e,o.crossOrigin=n?"anonymous":!1,o.onload=()=>s(o)}),B=(e,n,s,o)=>{const t=e-s,a=n-o,r=Math.sqrt(t**2+a**2);return{x:t,y:a,distance:r}},N=(e,n,s,o,t=4)=>{const a=s+t,r=o+t,c=t*t;let u=0,v=0,d=0,m=0;for(let X=s;X<a;X++)for(let Y=o;Y<r;Y++){const M=(X*n+Y)*4;u+=e[M],v+=e[M+1],d+=e[M+2],m+=e[M+3]}const E=u/c,P=v/c,U=d/c,q=m/c;return{x:o+t/2,y:s+t/2,originX:o+t/2,originY:s+t/2,color:`rgba(${E}, ${P}, ${U}, ${q/255})`}},i=g(null),_=g(null),p=g([]),F=g({x:1/0,y:1/0}),R=g(1),h=g();let w,l=i.value?.width,y=i.value?.height;const S=e=>{const n=Math.round(y/x),s=Math.round(l/x),o=[];for(let t=0;t<n;t++)for(let a=0;a<s;a++){const r=t*x,c=a*x,u=N(e,l,r,c,x);o.push(u)}return o},$=()=>{const e=_.value;e.clearRect(0,0,l,y),p.value.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,x/2,0,Math.PI*2),e.fillStyle=n.color,e.fill()})},j=()=>{const e=p.value,n=F.value,{x:s,y:o}=n;e.forEach(t=>{const{x:a,y:r,distance:c}=B(s,o,t.x,t.y);if(c<w){const u=(w-c)/w,v=Math.atan2(r,a),d=Math.cos(v)*u*C,m=Math.sin(v)*u*C;t.x-=d,t.y-=m}else if(t.x!==t.originX||t.y!==t.originY){const{x:u,y:v,distance:d}=B(t.originX,t.originY,t.x,t.y),m=Math.atan2(v,u),E=Math.cos(m)*d*k,P=Math.sin(m)*d*k;t.x+=E,t.y+=P}})},O=()=>{j(),$(),requestAnimationFrame(O)},z=async e=>{const n=await I(e,!0),{width:s,height:o}=n,t=i.value;h.value=t.getBoundingClientRect(),R.value=s/h.value.width,l=t.width=s,y=t.height=o;const a=_.value;a.drawImage(n,0,0,l,y);const r=a.getImageData(0,0,l,y),c=S(r.data);p.value=c,O()},f=e=>{const n=R.value,s=e?.touches?.[0],o=h.value.top,t=h.value.left;F.value={x:(s?.pageX-t||e.offsetX)*n,y:(s?.pageY-o||e.offsetY)*n}},L=()=>{F.value={x:1/0,y:1/0}},b=()=>{const e=i.value;h.value=e.getBoundingClientRect(),R.value=l/h.value.width};return H(i,()=>{const e=i.value;e&&(e.addEventListener("mousemove",f,{passive:!0}),e.addEventListener("mouseleave",L),e.addEventListener("touchstart",f,{passive:!0}),e.addEventListener("touchmove",f,{passive:!0}),e.addEventListener("touchend",L,{passive:!0}),window.addEventListener("resize",b,{passive:!0}))}),W(()=>{const e=i.value;e&&(e.removeEventListener("mousemove",f),e.removeEventListener("mouseleave",L),e.removeEventListener("touchstart",f),e.removeEventListener("touchmove",f),e.removeEventListener("touchend",L),window.removeEventListener("resize",b))}),G(()=>{w=window.innerWidth<576?300:200;const e=i.value;e&&(_.value=e.getContext("2d"),z("https://raw.githubusercontent.com/jwlearn1994/image-uploader/main/others/myblog/me2.jpeg"))}),(e,n)=>(J(),V("div",Q,[K("canvas",{ref_key:"canvasRef",ref:i,style:{width:"100%"}},null,512)]))}};export{D as default};
