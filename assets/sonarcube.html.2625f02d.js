import{_ as r,o,a as l,d as n,b as e,F as p,e as s,f as t,r as c}from"./app.41f96392.js";const i={},u=n("h1",{id:"\u4E32\u63A5-sonarcube-\u7B46\u8A18",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u4E32\u63A5-sonarcube-\u7B46\u8A18","aria-hidden":"true"},"#"),s(" \u4E32\u63A5 Sonarcube \u7B46\u8A18")],-1),b=n("p",null,"SonarQube \u662F\u4E00\u6B3E\u57FA\u65BC Java \u958B\u767C\u7684\u539F\u59CB\u78BC\u6AA2\u6E2C\u8207\u54C1\u8CEA\u7BA1\u7406\u7CFB\u7D71\uFF0C\u56E0\u8457 Java \u7684\u95DC\u4FC2\uFF0CServer \u8207 Client \u90FD\u662F\u8DE8\u5E73\u53F0\u7684",-1),d=n("h2",{id:"install",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#install","aria-hidden":"true"},"#"),s(" Install")],-1),h={href:"https://docs.sonarqube.org/latest/setup/get-started-2-minutes/#Installing%20a%20local%20instance%20of%20SonarQube",target:"_blank",rel:"noopener noreferrer"},k=s("Link"),_=t(`<h3 id="docker-image" tabindex="-1"><a class="header-anchor" href="#docker-image" aria-hidden="true">#</a> docker image</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> sonarqube <span class="token parameter variable">-e</span> <span class="token assign-left variable">SONAR_ES_BOOTSTRAP_CHECKS_DISABLE</span><span class="token operator">=</span>true <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 sonarqube:latest
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,2),m=s("\u524D\u5F80 "),g={href:"http://localhost:9000",target:"_blank",rel:"noopener noreferrer"},f=s("http://localhost:9000"),v=s(" \u958B\u555F Web \u4ECB\u9762"),y=n("h2",{id:"\u5EFA\u7ACB-sonarcube-\u5C08\u6848",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5EFA\u7ACB-sonarcube-\u5C08\u6848","aria-hidden":"true"},"#"),s(" \u5EFA\u7ACB sonarcube \u5C08\u6848")],-1),q=n("p",null,"\u5728 sonar \u4E0A\u5EFA\u7ACB manual project",-1),j=n("ol",null,[n("li",null,"Create new project - manual"),n("li",null,"\u8A2D\u5B9A Project key, Display name"),n("li",null,"\u7522\u751F\u4E00\u7D44 token \u4E26\u59A5\u5584\u4FDD\u5B58"),n("li",null,"\u57F7\u884C\u5206\u6790\u5C08\u6848\uFF0C\u6B64\u6B65\u9A5F\u9700\u4E0B\u8F09 scanner")],-1),x=n("h2",{id:"\u4E0B\u8F09-scanner",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u4E0B\u8F09-scanner","aria-hidden":"true"},"#"),s(" \u4E0B\u8F09 scanner")],-1),E=s("\u6839\u64DA\u74B0\u5883\u53EF\u4EE5"),R={href:"https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/",target:"_blank",rel:"noopener noreferrer"},S=s("\u5728\u6B64"),N=s("\u4E0B\u8F09\u4E0D\u540C\u7684 scanner"),D=n("h2",{id:"ci-\u4E32\u63A5",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ci-\u4E32\u63A5","aria-hidden":"true"},"#"),s(" CI \u4E32\u63A5")],-1),C={href:"https://docs.sonarqube.org/latest/analysis/jenkins/",target:"_blank",rel:"noopener noreferrer"},O=s("Link"),T=n("p",null,"\u4EE5 Github \u8209\u4F8B",-1),A={href:"https://docs.sonarqube.org/latest/analysis/github-integration/",target:"_blank",rel:"noopener noreferrer"},P=s("Github integration"),B=t('<ol><li>\u5275\u5EFA Github App \u4E26\u5B89\u88DD\u5230\u76EE\u6A19\u5C08\u6848\u7684 Organization</li><li>\u8A2D\u5B9A sonarcube \u5C08\u6848</li></ol><h3 id="webhooks" tabindex="-1"><a class="header-anchor" href="#webhooks" aria-hidden="true">#</a> Webhooks</h3><p>\u52A0\u5165 PR Webhook</p><h3 id="pr-decoration" tabindex="-1"><a class="header-anchor" href="#pr-decoration" aria-hidden="true">#</a> PR Decoration</h3><p>sonar.com &gt; Your project &gt; Project Settings &gt; General Settings &gt; Pull Request Decoration</p><h3 id="quality-profiles" tabindex="-1"><a class="header-anchor" href="#quality-profiles" aria-hidden="true">#</a> Quality Profiles</h3><p>\u6839\u64DA\u5C08\u6848\u9700\u6C42\uFF0C\u5728\u8A2D\u5B9A\u9801\u9762\u88E1\u7684 <code>Quality Profiles</code> \u52A0\u5165\u5C0D\u6383\u63CF\u7684\u5957\u7528\u898F\u7BC4</p><ul><li>CSS: sonar way</li></ul><h2 id="\u8A2D\u5B9A-package-json-\u7522\u751F-coverage-report" tabindex="-1"><a class="header-anchor" href="#\u8A2D\u5B9A-package-json-\u7522\u751F-coverage-report" aria-hidden="true">#</a> \u8A2D\u5B9A package.json \u7522\u751F coverage report</h2>',9),L={href:"https://docs.sonarqube.org/latest/analysis/test-coverage/javascript-typescript-test-coverage/",target:"_blank",rel:"noopener noreferrer"},G=s("javascript-typescript-test-coverage"),$=t(`<div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test:ci&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --ci --collectCoverage&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="\u8A2D\u5B9A-sonar-project-properties" tabindex="-1"><a class="header-anchor" href="#\u8A2D\u5B9A-sonar-project-properties" aria-hidden="true">#</a> \u8A2D\u5B9A sonar-project.properties</h2>`,2),I=s("\u5EFA\u7ACB\u5C08\u6848\u5F8C\uFF0C\u9700\u8981\u7522\u751F\u4E00\u7D44 "),Q=n("code",null,"sonar_login_token",-1),U=s(" \u4F7F\u7528\uFF0C\u4E26\u6839\u64DA"),w={href:"https://docs.sonarqube.org/8.9/analysis/analysis-parameters/",target:"_blank",rel:"noopener noreferrer"},H=s("\u9019\u500B\u6559\u5B78"),V=s("\u9032\u884C sonar \u7684 project \u914D\u7F6E"),F=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">sonar.host.url</span><span class="token operator">=</span>	http://localhost:9000
<span class="token assign-left variable">sonar.login</span><span class="token operator">=</span>your_login_token
<span class="token assign-left variable">sonar.projectBaseDir</span><span class="token operator">=</span>./
<span class="token comment"># sonar \u4E0A\u7684\u5C08\u6848\u540D\u7A31</span>
<span class="token assign-left variable">sonar.projectKey</span><span class="token operator">=</span>your_project_name

<span class="token comment"># test coverage report \u4F4D\u7F6E</span>
<span class="token assign-left variable">sonar.javascript.lcov.reportPaths</span><span class="token operator">=</span>coverage/lcov.info

<span class="token comment"># scanner \u898F\u5247\u8A2D\u5B9A</span>
<span class="token assign-left variable">sonar.sources</span><span class="token operator">=</span>src
<span class="token assign-left variable">sonar.eslint.eslintconfigpath</span><span class="token operator">=</span>.eslintrc.js
<span class="token assign-left variable">sonar.typescript.tsconfigPath</span><span class="token operator">=</span>tsconfig.json
<span class="token assign-left variable">sonar.coverage.exclusions</span><span class="token operator">=</span>**/node_modules/**, **.spec.ts, **.test.ts, **.spec.js, **.test.js, **/*.html, **/next.config.js

<span class="token comment"># Encoding of the source code. Default is default system encoding</span>
<span class="token assign-left variable">sonar.sourceEncoding</span><span class="token operator">=</span>UTF-8

<span class="token comment"># \u5C08\u6848\u4F4D\u7F6E</span>
<span class="token assign-left variable">sonar.analysis.repoLink</span><span class="token operator">=</span>path_to_your_repository
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="\u8A2D\u5B9A-drone-yml" tabindex="-1"><a class="header-anchor" href="#\u8A2D\u5B9A-drone-yml" aria-hidden="true">#</a> \u8A2D\u5B9A drone.yml</h2><p>\u4EE5\u4E0B\u7BC4\u4F8B\uFF0C\u914D\u7F6E jest \u7522\u751F report\uFF0C\u4E26\u63A5\u8457\u57F7\u884C sonar scanner</p><blockquote><p>\u9700\u8981\u6CE8\u610F\uFF0C\u56E0\u70BA sonar scanner \u6703\u6839\u64DA\u50B3\u5165\u7684\u53C3\u6578\u5224\u65B7\u662F push \u6216\u662F pull_request\uFF0C\u5982\u679C\u50B3\u5165\u53C3\u6578\u88E1\u6709 pull request \u76F8\u95DC\u8A2D\u5B9A\uFF0C\u5373\u4F7F\u662F null \u503C\uFF0C\u4E00\u6A23\u6703\u88AB\u5224\u5B9A\u6210 pull_request\uFF0C\u9019\u6A23\u6703\u5C0E\u81F4\u5BE6\u969B merge \u9032 main branch \u6642\u6C92\u6709\u88AB\u6B63\u78BA\u89E3\u6790\uFF0C\u800C\u662F\u88AB\u7576\u6210 pull_request \u8655\u7406\u4E86\uFF0C\u767C\u751F\u9019\u554F\u984C\u6642\u932F\u8AA4\u63D0\u793A\u53EA\u6703\u986F\u793A</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u201Cmaster\u201D branch has not been analyzed yet and you have multiple branches already
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,5),K=s("\u4F46\u5BE6\u969B\u4E0A\u539F\u56E0\u53EF\u80FD\u662F\u53C3\u6578\u6703\u76F8\u95DC\u8A2D\u5B9A\u932F\u8AA4\u5C0E\u81F4\uFF0C\u53EF"),W={href:"https://community.sonarsource.com/t/main-branch-does-not-reflect-latest-analyses/63352",target:"_blank",rel:"noopener noreferrer"},z=s("\u53C3\u8003\u9019\u7BC7\u8A0E\u8AD6\u4E32"),J=t(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">name</span><span class="token punctuation">:</span> default

<span class="token key atrule">trigger</span><span class="token punctuation">:</span>
  <span class="token key atrule">branch</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;precommit/*&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">event</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;push&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pull_request&quot;</span><span class="token punctuation">]</span>

<span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> prepare
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;node:16.13.1&quot;</span>
    <span class="token key atrule">commands</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;npm run lint&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;npm run test:ci&quot;</span>

  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sonar<span class="token punctuation">-</span>scan
    <span class="token key atrule">image</span><span class="token punctuation">:</span> sonarsource/sonar<span class="token punctuation">-</span>scanner<span class="token punctuation">-</span>cli
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">SONAR_TOKEN</span><span class="token punctuation">:</span>
        <span class="token key atrule">from_secret</span><span class="token punctuation">:</span> sonar_login_token
    <span class="token key atrule">commands</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;if (echo $DRONE_TARGET_BRANCH$DRONE_PULL_REQUEST | grep -w $DRONE_TARGET_BRANCH); then sonar-scanner; else sonar-scanner -Dsonar.pullrequest.key=$DRONE_PULL_REQUEST -Dsonar.pullrequest.branch=$DRONE_SOURCE_BRANCH -Dsonar.pullrequest.base=$DRONE_TARGET_BRANCH; fi;&quot;</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> prepare
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div>`,1);function Y(M,X){const a=c("ExternalLinkIcon");return o(),l(p,null,[u,b,d,n("ul",null,[n("li",null,[n("a",h,[k,e(a)])])]),_,n("p",null,[m,n("a",g,[f,e(a)]),v]),y,q,j,x,n("p",null,[E,n("a",R,[S,e(a)]),N]),D,n("ul",null,[n("li",null,[n("a",C,[O,e(a)])])]),T,n("ul",null,[n("li",null,[n("a",A,[P,e(a)])])]),B,n("ul",null,[n("li",null,[n("a",L,[G,e(a)])])]),$,n("p",null,[I,Q,U,n("a",w,[H,e(a)]),V]),F,n("p",null,[K,n("a",W,[z,e(a)])]),J],64)}var nn=r(i,[["render",Y],["__file","sonarcube.html.vue"]]);export{nn as default};
