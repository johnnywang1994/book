import{_ as p,c as i,b as n,a as t,d as o,e as a,r as l,o as c}from"./app-DjGzEHQz.js";const r={};function u(d,s){const e=l("SocialBlock");return c(),i("div",null,[s[0]||(s[0]=n("h1",{id:"safari-使用-animation-時動態產生-rem-的坑",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#safari-使用-animation-時動態產生-rem-的坑"},[n("span",null,"Safari 使用 animation 時動態產生 rem 的坑")])],-1)),s[1]||(s[1]=n("h6",{id:"tags-css-rem-animation",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#tags-css-rem-animation"},[n("span",null,[a("tags: "),n("code",null,"CSS"),a(),n("code",null,"rem"),a(),n("code",null,"animation")])])],-1)),t(e,{hashtags:"css,rem,animation"}),s[2]||(s[2]=o(`<p>本篇誕生於同事日常開發動畫時遇到的問題，覺得是個不錯的主題，記錄下來：</p><p>主要需求很簡單，就只是使用 <code>@keyframes</code> \b對元素進行上下懸浮的效果。並且浮動的長度單位使用的是動態生成的 rem。</p><blockquote><p>動態生成 rem 的意思是，使用 js 並根據畫面螢幕尺寸變化，動態調整 <code>html</code> 的 <code>font-size</code> 大小，並在內部都使用 rem 來作為大小長度等尺寸依賴，藉此達到整體畫面文字圖片比例的自適應。</p></blockquote><h2 id="方法一" tabindex="-1"><a class="header-anchor" href="#方法一"><span>方法一</span></a></h2><p>第一種作法如下：</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-scss line-numbers-mode" data-highlighter="prismjs" data-ext="scss"><pre><code><span class="line"><span class="token comment">// 假設當前畫面 html font-size 是 100px，並且會隨著畫面放大縮小而變大變小</span></span>
<span class="line"><span class="token selector">html </span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token selector">#id </span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">top</span><span class="token punctuation">:</span> 0.3rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token property">animation</span><span class="token punctuation">:</span> floating 1s linear infinite<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> floating</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">from</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">top</span><span class="token punctuation">:</span> 0.28rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token selector">to </span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">top</span><span class="token punctuation">:</span> 0.32rem<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我們預期元素會在 0.28 ~ 0.32rem 的範圍內上下浮動。實際開啟瀏覽器也確實沒有問題。</p><p>但是！！，如果只是這麼簡單就不用這篇記錄了，當使用 <code>Safari</code> 瀏覽器開啟時，會發現只有一開始進入畫面時會是正確的位置，之後不論畫面放大縮小，懸浮位置似乎不會隨著畫面放大或縮小而調整。</p><p>照理來說，流程應該像下面這樣：</p><blockquote><p>畫面 resize -&gt; rem 動態變大或變小 -&gt; animation 計算變化 -&gt; 元素位置修正</p></blockquote><p>但事與願違，他就是跑到一個很怪。</p><p><strong>發生原因</strong></p><p>經測試後了解發生原因是因為 <code>Safari</code> 會將靜態 CSS 的尺寸快取起來，頁面第一次載入後，為了提升效能，<code>Safari</code> 把一些靜態 CSS 快取起來，加快下次載入的速度，而所謂的 <code>靜態 CSS</code> 究竟包括了哪些？對，這就是本篇重點！！對於 CSS 來說，哪些是動態資源、哪些是靜態資源必須特別加以分辨。</p><p>上面的 <code>top</code> 屬性在 CSS 中，就屬於靜態資源，只會經過一次的瀏覽器計算，並且被快取起來，但製作動畫時，我們希望的是在每次畫面調整後，都能自動適應，並且維持最佳效能的東西，當今天只要定位元素時，就是使用靜態資源的時機; 但製作動畫時，如果使用靜態資源，會造成整個 CSS 的整個重新畫面渲染，這又牽涉到了 CSS 渲染重繪的分層 layout 概念。</p><blockquote><p>段落大意：動畫使用動態資源，定位使用靜態資源。</p></blockquote><h2 id="方法二" tabindex="-1"><a class="header-anchor" href="#方法二"><span>方法二</span></a></h2><p>方法二就是使用 CSS <code>transform</code> 來進行，當使用 <code>transform</code> 時，我們會利用 scale, translate, rotate 等等 CSS <strong><code>函數</code></strong> 來計算動畫屬性，而這個函數，在 CSS 中會動態求值，也因此可以解決這個快取問題。</p><p>改寫如下：</p><div class="language-scss line-numbers-mode" data-highlighter="prismjs" data-ext="scss"><pre><code><span class="line"><span class="token atrule"><span class="token rule">@keyframes</span> floating</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">from</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-0.02rem<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token selector">to </span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0.02rem<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用一樣的 rem 來設定，但這次不論畫面怎麼 resize，瀏覽器都能完美的呈現動畫該有的效果尺寸。</p>`,21)),t(e,{hashtags:"css,rem,animation"})])}const k=p(r,[["render",u]]),v=JSON.parse('{"path":"/articles/css/animation-rem.html","title":"Safari 使用 animation 時動態產生 rem 的坑","lang":"zh-TW","frontmatter":{},"git":{"updatedTime":1648521821000,"contributors":[{"name":"Johnny Wang","username":"","email":"wangj@garena.com","commits":2},{"name":"johnnywang1994","username":"johnnywang1994","email":"johnny29621189@kimo.com","commits":3,"url":"https://github.com/johnnywang1994"}],"changelog":[{"hash":"71ccb7693345c8ddc2f554e00f8a0ce73af2b783","time":1648521821000,"email":"johnny29621189@kimo.com","author":"johnnywang1994","message":"UPD: upgrade to v2"},{"hash":"da1521dcf805739a83e5efa4e52581013a51dcad","time":1638541816000,"email":"johnny29621189@kimo.com","author":"johnnywang1994","message":"UPD: update sociallinks"},{"hash":"5462f39c3447f0f8414e62396aeb3bb3de51884d","time":1638540999000,"email":"johnny29621189@kimo.com","author":"johnnywang1994","message":"UPD: add share-social"},{"hash":"e4934b227e750cf780d547efbbb68d62ffe4580d","time":1629951525000,"email":"wangj@MBPR-1110-2.local","author":"Johnny Wang","message":"UPD: update"},{"hash":"51e618d93d4f837fbce25a1e1f0a9783cbc46b6a","time":1624012650000,"email":"wangj@garena.com","author":"Johnny Wang","message":"INIT"}]},"filePathRelative":"articles/css/animation-rem.md"}');export{k as comp,v as data};
